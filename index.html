<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="https://j-devspace.github.io/pws_test/">
    <title>My PWA</title>
    <link rel="manifest" href="manifest.json">

</head>

<body>
    <h1>My PWA App</h1>
    <button type="button" onclick="sendPushNotification()">알람전송</button>
    <div class="divResult"></div>

    <script type="module" src="./initFCM.js"></script>
    <script src="./fcm.js"></script>
    <script>

        const serviceAccount = {
            "type": "service_account",
            "project_id": "je-test-e14c9",
            "private_key_id": "d0710b90161725fd3b7ad39f281f42655f34867d",
            "private_key": "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDa1ameSdAFUft8/7WkHkXw/CK1PW4QW3hJzq2j+AphyYYqc83JMUbLQAmJXmBg616AAoKoe90DWkFcNkbrefmJM9kJSiMs79BQxrR2ObjK1qIygbzmiqeu49SV0wdjXnDYqsLBJORVmCrIDuKdaa3/dJsTUqYwfjD1ONNY+R4S4LVxf3k0gkCY7hifZiJ5Hx915EZNkEmcu6S3tMLLEcPkjujYM3/FY51r/bjG9hnVmMH2UJa26xWTeoLm41IKgO7klGPevDgBh/i9oa7kT6KL5KYnF++ltEUD22JJDrkSPGFQf/bqEkq9dTJzqlZvyUsd+V6TrKwMmgm+ZhjL7EJPAgMBAAECggEAGj1hJP7Fd8Mt0ajjweBzaIMDMmeW8//T0PMnCls/+3EWVQQlGnPTK6SWatIAjSk2ip5CcStxA+mQSXCkrlr7he0hStDd85HJ5nWnxpQDSXx/tGiuxZdopeWMZG61GxWEQyauoEmT1i5J1Z/wol69ThKlqaUmZ6LUrK16Ai1/jVRgWTrbWQlVytQMkvGARtzWKD9kdhFBt2Y96OA6HEEPy5ADX2SAo7zU/px+AaLsExYmLsuS8IWh07n+Xmh/K0dqAgnkAs8BDivKb7oLJFXELuqjQfY5RTzZw8WPcZrkrporcfr5g6f1KV4nzEeNkJ8bQr4mp+JkHxuDL6V1VlMmkQKBgQDzxp32KA4B+LSUMVImJ0EozNXTtSKwbY8p5bdeuTNgcqaWtElj1TPjqGaBeU3V43/C5p50XI4BFwDx7CUWFNjp2+EB4Q5sn2oBgW7bFPYarOvdRYWn01AXV9eYeKoAShsDlD7veMsdgRypWTRzbNIr3HY7ZqvW6wd7VBD3GD8h+QKBgQDlzt8lxg4OeM/TJZeRPRRNFYfIx2Q2YQHC64EAf8nR6h9YZ08sJJDH6OAXlIOrVWVCylvCgjgVQaLRAG09ee6au1K0Lmyc0HiIC1QU8MbPLmZsBHpnrYg1Vv1Jo+0GZXW0xqHiwFDea/DyUAFlm0tvVbUWJNX2D5zibQxKT4IYhwKBgQDg5vou8u9RdFGtcv9WQdsEuE4CHtgdK0bsoYmWc4jpz3zQBw66cyWHQIMpqm9cCKKDft7rfcRpTv7JM1NX1u30e65QXIFBR6W2M+LBbspK/AQzRYO0vOjkUF+QxKoa0EOx/qA9sRS7aLW3q5wPbXNNkfzmeqfJBVcGuh1Yyl7ciQKBgEjwhTEXEKUVQVlSKC5IBaaFu+hFKRB9b7KvTu2aobMHrVVAzQdEv9NDncS+NaBu5UnysnclH6nXgFb33LRTfCEObayUw5JuNKNxfQl8do2Ru55zOWqo0H+lkZUK+5M5Jsfu97jhs4k1F2/BZwAZ7zJyMJzLqkGEKRZQ6EK5w6AHAoGAHVM6O1LewxAhkm+sSw0Ld21ca1JhyfTT9bG/DSuINWZ23psvxu7H00OYXZU0Z7w1prDtdV7A/fCErGP3QPSQ+Cr9o6ZW3mx72fN4mcYU5d0frskhBLK9Gtj95l57DmbGi0xUvl+PAbCk3GUz/qei5cXZtTWfcH31HjfdxBx6LUE=",
            "client_email": "firebase-adminsdk-fbsvc@je-test-e14c9.iam.gserviceaccount.com",
            "client_id": "107588653504297096705",
            "auth_uri": "https://accounts.google.com/o/oauth2/auth",
            "token_uri": "https://oauth2.googleapis.com/token",
            "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
            "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40je-test-e14c9.iam.gserviceaccount.com",
            "universe_domain": "googleapis.com"
        };
        const firebaseConfig = {
            apiKey: "AIzaSyBUTB7eB75zqP2ER1xG7WDRldh9cS-rGy8",
            authDomain: "je-test-e14c9.firebaseapp.com",
            projectId: "je-test-e14c9",
            storageBucket: "je-test-e14c9.firebasestorage.app",
            messagingSenderId: "565490563935",
            appId: "1:565490563935:web:b73c5948df8f14b45794ea",
            measurementId: "G-137ECMGPH2"
        };
        const private_key_id = "d0710b90161725fd3b7ad39f281f42655f34867d";
        const projectId = "565490563935";


        function WriteLog(message) {
            const $divResult = document.querySelector('.divResult');
            $divResult.innerHTML = `${$divResult.innerHTML}\n${message}`
            $divResult.innerHTML = `${$divResult.innerHTML}<hr>`
        }

        try {

            // 알람 허용 여부
            Notification.requestPermission().then((permission) => {
                if (permission === "granted") {
                    WriteLog("알림 권한이 허용되었습니다.");
                } else {
                    WriteLog("알림 권한이 거부되었습니다.");
                }
            });

            // 서비스워커 선언
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", function () {
                    navigator.serviceWorker.getRegistrations().then((registrations) => {
                        for (let registration of registrations) {
                            registration.unregister();
                        }
                    }).then(() => {
                        WriteLog('All service workers unregistered.');

                        const swUrl = `/pws_test/firebase-messaging-sw.js`;

                        // navigator.serviceWorker
                        // .register(swUrl, {
                        //     scope: process.env.PUBLIC_URL || '/', // 현재 애플리케이션의 경로를 scope로 설정
                        // })




                        navigator.serviceWorker
                            .register(swUrl, {scope: '/pws_test/'})
                            .then(function (registration) {
                                WriteLog(`Service Worker가 scope에 등록되었습니다.: ${registration.scope}`);
                                console.log(
                                    "Service Worker가 scope에 등록되었습니다.:",
                                    registration.scope
                                );
                            })
                            .catch(function (err) {
                                WriteLog(`Service Worker 등록 실패: ${JSON.stringify(err)}`);
                                console.log("Service Worker 등록 실패:", err);
                            });
                    });
                });
            }

        }
        catch (err) {
            WriteLog(`Service Worker 등록 실패: ${JSON.stringify(err)}`);
        }

    </script>
</body>

</html>